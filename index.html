<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üòáAngelic Tic Tac Toeü§≠</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Pre-Game Welcome Overlay - Minimal Cinematic -->
    <div id="pre-welcome-overlay" class="pre-welcome-overlay">
        <div class="pre-welcome-content">
            <!-- Title -->
            <h1 class="pre-welcome-title fade-in-delay-1">WELCOME</h1>

            <!-- Explanation -->
            <div class="pre-welcome-messages">
                <p class="pre-welcome-text fade-in-delay-2">You are about to face an adaptive AI.</p>
                <p class="pre-welcome-text fade-in-delay-3">It learns your patterns. It does not repeat mistakes.</p>
                <p class="pre-welcome-text fade-in-delay-4">Every move you make is remembered.</p>
            </div>

            <!-- Divider -->
            <div class="pre-welcome-divider fade-in-delay-5">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</div>

            <!-- Progression Hint -->
            <div class="pre-welcome-features fade-in-delay-6">
                <p class="pre-welcome-feature">Levels exist. Power-ups exist.</p>
                <p class="pre-welcome-feature">You must earn your progression.</p>
            </div>

            <!-- Continue Button -->
            <button id="continue-welcome-btn" class="pre-welcome-continue fade-in-delay-7">
                I'm Ready
            </button>
        </div>
    </div>

    <div class="container">
        <div id="welcome-screen" class="screen active">
            <h1 class="title">üòáAngelic Tic Tac Toeü§≠</h1>
            <div class="form-container">
                <input type="text" id="player-name" placeholder="Enter your name..." required>

                <div class="camera-section">
                    <div class="camera-status" id="camera-status">
                        <span class="camera-icon">üìπ</span>
                        <span class="camera-text">Camera access required to prevent cheating</span>
                    </div>
                    <button id="enable-camera-btn" class="camera-btn">Enable Camera</button>
                    <div class="camera-preview" id="camera-preview" style="display: none;">
                        <video id="camera-feed" autoplay muted playsinline></video>
                        <div class="camera-status-indicator">
                            <span class="status-dot active"></span>
                            <span>Camera Active - Live Streaming</span>
                        </div>
                    </div>
                </div>

                <button id="start-btn" disabled>Enter In Peace</button>
            </div>
        </div>

        <div id="game-screen" class="screen">
            <!-- Power-Up Sidebar HUD -->
            <div id="powerup-sidebar" class="powerup-sidebar">
                <div class="powerup-sidebar-header">
                    <h3 class="powerup-title">Power-Ups</h3>
                    <div class="powerup-level">Level <span id="powerup-level-display">1</span></div>
                    <button id="powerup-toggle" class="powerup-toggle" aria-label="Toggle sidebar">
                        <span class="powerup-toggle-icon">‚ñº</span>
                    </button>
                </div>
                <div id="powerup-list" class="powerup-list">
                    <!-- Power-ups will be dynamically generated -->
                </div>
            </div>

            <div class="game-info">
                <div id="player-info">Player: <span id="display-name"></span></div>
                <div id="wins-counter">Wins: <span id="wins">0</span></div>
                <div id="losses-counter">Losses: <span id="losses">0</span></div>
                <div class="game-camera-status">
                    <span class="camera-icon">üìπ</span>
                    <span id="game-camera-status">Monitoring</span>
                </div>
            </div>

            <!-- Level 1 progress: 5 wins to complete -->
            <div class="level-progress-container" aria-label="Level progress">
                <div class="level-progress-visual">
                    <div class="level-progress-dots">
                        <span class="progress-dot" data-win="1">‚óã</span>
                        <span class="progress-dot" data-win="2">‚óã</span>
                        <span class="progress-dot" data-win="3">‚óã</span>
                        <span class="progress-dot" data-win="4">‚óã</span>
                        <span class="progress-dot" data-win="5">‚óã</span>
                    </div>
                    <div class="level-progress-bar">
                        <div id="level-progress-fill" class="level-progress-fill"></div>
                    </div>
                </div>
                <div class="level-progress-text">
                    Wins this level: <span id="level-wins-count">0</span> / 5
                </div>
            </div>

            <div id="message-box" class="message"></div>

            <div class="game-board">
                <div class="board-dim-overlay"></div>
                <div class="cell" data-index="0"></div>
                <div class="cell" data-index="1"></div>
                <div class="cell" data-index="2"></div>
                <div class="cell" data-index="3"></div>
                <div class="cell" data-index="4"></div>
                <div class="cell" data-index="5"></div>
                <div class="cell" data-index="6"></div>
                <div class="cell" data-index="7"></div>
                <div class="cell" data-index="8"></div>
            </div>

            <button id="reset-btn">Play Again... if you dare</button>

            <!-- Guide Icon Button (in game screen) -->
            <button id="guide-icon-btn-game" class="guide-icon-btn" aria-label="Open Guide">
                <span class="guide-icon">?</span>
            </button>
        </div>

        <div id="tsukuyomi-overlay" class="hidden">
            <img src="madara.webp" alt="Mangeky≈ç Sharingan" class="sharingan">
            <div id="tsukuyomi-countdown" class="countdown"></div>
        </div>

        <div id="demon-overlay" class="hidden">
            <img src="demon.avif" alt="Demon" class="demon-image">
        </div>

        <div id="disco-overlay" class="hidden">
            <div class="disco-lights"></div>
        </div>

        <!-- Snowfall effect container for first loss -->
        <div id="snowfall-container" class="hidden"></div>

        <div id="ai-mock-overlay" class="hidden">
            <div class="ai-mock-container">
                <div class="ai-mock-message" id="ai-mock-text"></div>
                <div class="ai-mock-buttons" id="ai-mock-buttons">
                    <button class="mock-btn mock-yes" id="mock-yes-btn">YES</button>
                    <button class="mock-btn mock-no" id="mock-no-btn">NO</button>
                </div>
            </div>
        </div>

        <!-- Sarah Narrative Overlay -->
        <div id="sarah-narrative-overlay" class="sarah-narrative-overlay hidden">
            <div class="sarah-narrative-container">
                <div class="sarah-narrative-message" id="sarah-narrative-text"></div>
                <div class="sarah-narrative-actions" id="sarah-narrative-actions"></div>
            </div>
        </div>

        <!-- Power Up Guide (Multi-page Manual) -->
        <div id="powerup-guide-overlay" class="powerup-guide-overlay hidden">
            <div class="powerup-guide-container">
                <!-- Page 1: Introduction -->
                <div class="guide-page active" data-page="1">
                    <h2 class="guide-title">How the Game Works</h2>
                    <p class="guide-text">This game is played against an adaptive AI. The AI is smart and learns from
                        your moves, but it is not impossible to beat. You can win with good strategy. You progress
                        through levels by winning rounds. Power ups help you make strategic decisions, but timing
                        matters.</p>
                    <div class="guide-board-preview">
                        <div class="guide-board-cell"></div>
                        <div class="guide-board-cell"></div>
                        <div class="guide-board-cell"></div>
                        <div class="guide-board-cell"></div>
                        <div class="guide-board-cell"></div>
                        <div class="guide-board-cell"></div>
                        <div class="guide-board-cell"></div>
                        <div class="guide-board-cell"></div>
                        <div class="guide-board-cell"></div>
                    </div>
                </div>

                <!-- Page 2: Level System -->
                <div class="guide-page" data-page="2">
                    <h2 class="guide-title">Levels & Progress</h2>
                    <div class="guide-level-visual">
                        <div class="guide-level-circles">
                            <div class="guide-circle"></div>
                            <div class="guide-circle"></div>
                            <div class="guide-circle"></div>
                            <div class="guide-circle"></div>
                            <div class="guide-circle"></div>
                        </div>
                    </div>
                    <p class="guide-text">Each level requires 5 wins to advance. Losing does not reset your progress.
                    </p>
                </div>

                <!-- Page 3: Power Ups Overview -->
                <div class="guide-page" data-page="3">
                    <h2 class="guide-title">Power Ups</h2>
                    <div class="guide-powerups-overview">
                        <div class="guide-powerup-card" data-powerup="hintPulse">
                            <div class="guide-powerup-icon">üí°</div>
                            <div class="guide-powerup-name">Hint Pulse</div>
                            <p class="guide-powerup-desc">Briefly shows a recommended move</p>
                        </div>
                        <div class="guide-powerup-card" data-powerup="boardShake">
                            <div class="guide-powerup-icon">üåä</div>
                            <div class="guide-powerup-name">Board Shake</div>
                            <p class="guide-powerup-desc">Reindexes cell positions</p>
                        </div>
                        <div class="guide-powerup-card" data-powerup="lastStand">
                            <div class="guide-powerup-icon">‚ö°</div>
                            <div class="guide-powerup-name">Last Stand</div>
                            <p class="guide-powerup-desc">Extra move when one from losing</p>
                        </div>
                    </div>
                </div>

                <!-- Page 4: Hint Pulse -->
                <div class="guide-page" data-page="4">
                    <h2 class="guide-title">Hint Pulse</h2>
                    <div class="guide-powerup-demo">
                        <div class="guide-demo-board" id="guide-hint-demo-board">
                            <div class="guide-demo-cell" data-index="0">X</div>
                            <div class="guide-demo-cell" data-index="1">O</div>
                            <div class="guide-demo-cell" data-index="2"></div>
                            <div class="guide-demo-cell" data-index="3">X</div>
                            <div class="guide-demo-cell guide-hint-pulse-demo" data-index="4"></div>
                            <div class="guide-demo-cell" data-index="5">O</div>
                            <div class="guide-demo-cell" data-index="6"></div>
                            <div class="guide-demo-cell" data-index="7">X</div>
                            <div class="guide-demo-cell" data-index="8">O</div>
                        </div>
                        <div class="guide-demo-caption" id="guide-hint-caption">Highlighting best move...</div>
                    </div>
                    <p class="guide-text"><strong>Hint Pulse</strong><br>Briefly shows a recommended move for 2 seconds.
                        Use it when you are unsure.</p>
                    <div class="guide-notes">
                        <p>‚Ä¢ Does not play for you</p>
                        <p>‚Ä¢ Does not pause the AI</p>
                        <p>‚Ä¢ Can be used twice per run</p>
                        <p>‚Ä¢ Locks after two uses until next run</p>
                    </div>
                </div>

                <!-- Page 5: Board Shake -->
                <div class="guide-page" data-page="5">
                    <h2 class="guide-title">Board Shake</h2>
                    <div class="guide-powerup-demo">
                        <div class="guide-demo-board guide-board-shake-container" id="guide-board-shake-demo">
                            <div class="guide-demo-cell" data-index="0" data-mark="X">X</div>
                            <div class="guide-demo-cell" data-index="1" data-mark=""></div>
                            <div class="guide-demo-cell" data-index="2" data-mark="O">O</div>
                            <div class="guide-demo-cell" data-index="3" data-mark=""></div>
                            <div class="guide-demo-cell" data-index="4" data-mark="X">X</div>
                            <div class="guide-demo-cell" data-index="5" data-mark="O">O</div>
                            <div class="guide-demo-cell" data-index="6" data-mark=""></div>
                            <div class="guide-demo-cell" data-index="7" data-mark="X">X</div>
                            <div class="guide-demo-cell" data-index="8" data-mark=""></div>
                        </div>
                        <div class="guide-demo-caption" id="guide-shake-caption"></div>
                    </div>
                    <p class="guide-text"><strong>Board Shake</strong><br>Reindexes all cell positions once. All
                        existing marks remain, but their logical positions are remapped. The AI must recalculate after
                        remap.</p>
                    <div class="guide-notes">
                        <p>‚Ä¢ All marks remain on board</p>
                        <p>‚Ä¢ Positions are randomly remapped</p>
                        <p>‚Ä¢ Usable once per game</p>
                        <p>‚Ä¢ Level 1 only</p>
                    </div>
                </div>

                <!-- Page 6: Last Stand -->
                <div class="guide-page" data-page="6">
                    <h2 class="guide-title">Last Stand</h2>
                    <div class="guide-powerup-demo">
                        <div class="guide-demo-board guide-last-stand-board" id="guide-last-stand-demo">
                            <div class="guide-demo-cell" data-index="0" data-mark="O">O</div>
                            <div class="guide-demo-cell" data-index="1" data-mark="O">O</div>
                            <div class="guide-demo-cell" data-index="2" data-mark=""></div>
                            <div class="guide-demo-cell" data-index="3" data-mark="X">X</div>
                            <div class="guide-demo-cell" data-index="4" data-mark="X">X</div>
                            <div class="guide-demo-cell" data-index="5" data-mark=""></div>
                            <div class="guide-demo-cell" data-index="6" data-mark=""></div>
                            <div class="guide-demo-cell" data-index="7" data-mark=""></div>
                            <div class="guide-demo-cell" data-index="8" data-mark=""></div>
                        </div>
                        <div class="guide-demo-caption" id="guide-laststand-caption"></div>
                    </div>
                    <p class="guide-text"><strong>Last Stand</strong><br>Click Last Chance ‚Üí Choose a future play count
                        ‚Üí It activates automatically when you're about to lose on that play. Grants one extra player
                        move.</p>
                    <div class="guide-notes">
                        <p>‚Ä¢ Click to schedule deployment</p>
                        <p>‚Ä¢ Choose future play count (forward-only)</p>
                        <p>‚Ä¢ Auto-triggers when about to lose</p>
                        <p>‚Ä¢ Level 1 only</p>
                    </div>
                </div>

                <!-- Page 7: Tactical Claim (AI Power-Up) -->
                <div class="guide-page" data-page="7">
                    <h2 class="guide-title">Tactical Claim</h2>
                    <div class="guide-powerup-demo">
                        <div class="guide-demo-board guide-tactical-claim-board">
                            <div class="guide-demo-cell" data-mark="X">X</div>
                            <div class="guide-demo-cell" data-mark=""></div>
                            <div class="guide-demo-cell" data-mark="O">O</div>
                            <div class="guide-demo-cell" data-mark=""></div>
                            <div class="guide-demo-cell" data-mark="X">X</div>
                            <div class="guide-demo-cell" data-mark=""></div>
                            <div class="guide-demo-cell" data-mark="O">O</div>
                            <div class="guide-demo-cell" data-mark=""></div>
                            <div class="guide-demo-cell" data-mark=""></div>
                            <div class="guide-tactical-claim-overlay" aria-hidden="true">
                                <div class="guide-tactical-claim-grid"></div>
                                <div class="guide-tactical-claim-wave"></div>
                                <div class="guide-tactical-claim-text">AI recalculates its strategy...</div>
                            </div>
                        </div>
                    </div>
                    <p class="guide-text"><strong>Tactical Claim</strong><br>Tactical Claim allows the AI to temporarily
                        focus its strategy, forcing you to rethink your next moves. It is a strategic disruption, not a
                        cheat.</p>
                    <div class="guide-notes">
                        <p>??? AI only - appears in Level 1</p>
                        <p>??? Strategic disruption, not a cheat</p>
                        <p>??? The board briefly pulses to signal pressure</p>
                        <p>??? No cells are revealed or highlighted</p>
                        <p>??? Gameplay continues without pausing</p>
                        <p>??? AI stays fully active after it triggers</p>
                    </div>
                </div>

                <!-- Page 8: Closing -->
                <div class="guide-page" data-page="8">
                    <h2 class="guide-title">You are ready to play.</h2>
                    <button id="guide-start-game" class="guide-start-btn">Start Game</button>
                </div>

                <!-- Navigation -->
                <div class="guide-navigation">
                    <button class="guide-nav-btn guide-prev" id="guide-prev">‚Üê</button>
                    <div class="guide-page-indicator">
                        <span id="guide-page-number">1</span> / 8
                    </div>
                    <button class="guide-nav-btn guide-next" id="guide-next">‚Üí</button>
                </div>

                <!-- Skip button (only on first page) -->
                <button class="guide-skip" id="guide-skip">Skip</button>
            </div>
        </div>

        <!-- Guide Icon Button (to reopen guide) -->
        <button id="guide-icon-btn" class="guide-icon-btn" aria-label="Open Guide">
            <span class="guide-icon">?</span>
        </button>
    </div>

    <!-- Mode selection (AI or Player) shown after entering name and enabling camera -->
    <div id="mode-select" class="overlay hidden">
        <div class="mode-container">
            <h2>Choose Mode</h2>
            <div class="mode-buttons">
                <button id="mode-ai" class="mode-btn">Play vs AI</button>
                <button id="mode-player" class="mode-btn">Play vs Player</button>
            </div>
        </div>
    </div>

    <!-- Lobby screen for player-vs-player matchmaking -->
    <div id="lobby-screen" class="overlay hidden">
        <div class="lobby-container">
            <h2>Lobby - Online Players</h2>
            <div id="players-list" class="players-list"></div>
            <div class="lobby-actions">
                <button id="leave-lobby" class="secondary">Back</button>
            </div>
        </div>
    </div>

    <!-- Invite prompt overlay -->
    <div id="invite-overlay" class="overlay hidden">
        <div class="invite-box">
            <div id="invite-text">Player X wants to play with you</div>
            <div class="invite-actions">
                <button id="invite-accept">Accept</button>
                <button id="invite-decline">Decline</button>
            </div>
        </div>
    </div>

    <audio id="click-sound" src="button.mp3"></audio>
    <audio id="win-sound" src="evil laugh.wav"></audio>
    <audio id="lose-sound" src="scream.wav"></audio>
    <audio id="tsukuyomi-sound" src="dark-ambience.wav"></audio>
    <audio id="bg-music" src="Romantic Rap Instrumental - _Story_ _ Love Rap Beat(MP3_320K).mp3" preload="auto"
        loop></audio>
    <audio id="mock-music" src="blackbear - hot girl bummer [Low Budget Video](MP3_128K)_[cut_13sec].mp3"
        preload="auto"></audio>
    <audio id="mock-music-2sec" src="blackbear - hot girl bummer [Low Budget Video](MP3_128K)_[cut_2sec].mp3"
        preload="auto"></audio>
    <audio id="powerup-activate-sound" src="button.mp3" preload="auto"></audio>

    <!-- Theme Selection Overlay -->
    <div id="theme-selection-overlay" class="theme-selection-overlay">
        <div class="theme-selection-container">
            <h2 class="theme-selection-title">Choose Your Visual Style</h2>
            <p class="theme-selection-subtitle">Select a theme to personalize your experience</p>
            <div class="theme-preview-grid">
                <div class="theme-preview-card" data-theme="light">
                    <svg class="theme-checkmark" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" fill="currentColor" />
                        <path d="M9 12l2 2 4-4" stroke="white" stroke-width="2.5" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                    <div class="theme-preview-name">Light</div>
                    <div class="theme-preview-sample">
                        <div class="theme-preview-cell">X</div>
                        <div class="theme-preview-cell"></div>
                        <div class="theme-preview-cell">O</div>
                    </div>
                </div>
                <div class="theme-preview-card" data-theme="dark">
                    <svg class="theme-checkmark" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" fill="currentColor" />
                        <path d="M9 12l2 2 4-4" stroke="white" stroke-width="2.5" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                    <div class="theme-preview-name">Dark</div>
                    <div class="theme-preview-sample">
                        <div class="theme-preview-cell">X</div>
                        <div class="theme-preview-cell"></div>
                        <div class="theme-preview-cell">O</div>
                    </div>
                </div>
                <div class="theme-preview-card" data-theme="neon">
                    <svg class="theme-checkmark" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" fill="currentColor" />
                        <path d="M9 12l2 2 4-4" stroke="white" stroke-width="2.5" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                    <div class="theme-preview-name">Neon</div>
                    <div class="theme-preview-sample">
                        <div class="theme-preview-cell">X</div>
                        <div class="theme-preview-cell"></div>
                        <div class="theme-preview-cell">O</div>
                    </div>
                </div>
                <div class="theme-preview-card" data-theme="retro">
                    <svg class="theme-checkmark" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" fill="currentColor" />
                        <path d="M9 12l2 2 4-4" stroke="white" stroke-width="2.5" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                    <div class="theme-preview-name">Retro Arcade</div>
                    <div class="theme-preview-sample">
                        <div class="theme-preview-cell">X</div>
                        <div class="theme-preview-cell"></div>
                        <div class="theme-preview-cell">O</div>
                    </div>
                </div>
            </div>
            <button id="theme-confirm-btn" class="theme-confirm-btn">Continue</button>
        </div>
    </div>

    <!-- AI Presence During Gameplay (Decorative) -->
    <div id="ai-presence-gameplay" class="ai-presence-gameplay hidden">
        <div class="ai-orb"></div>
        <div class="ai-glow"></div>
    </div>

    <!-- Theme Switcher (Available during gameplay) -->
    <div id="theme-switcher" class="theme-switcher">
        <button id="theme-btn" class="theme-btn" title="Change Theme">
            <span class="theme-icon">üé®</span>
        </button>
        <div id="theme-menu" class="theme-menu hidden">
            <button class="theme-option" data-theme="light">Light</button>
            <button class="theme-option" data-theme="dark">Dark</button>
            <button class="theme-option" data-theme="neon">Neon</button>
            <button class="theme-option" data-theme="retro">Retro</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="server/behavior_analyzer.js"></script>
    <script src="server/ai_learning.js"></script>
    <script src="animations.js"></script>
    <script src="script.js"></script>
</body>

</html>